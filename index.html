<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MalariaScope AI - Revolutionary Diagnostics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Particle Background -->
    <div class="particles-bg">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo-section">
                <div class="logo-pulse">
                    <svg viewBox="0 0 50 50" class="logo-svg">
                        <circle cx="25" cy="25" r="20" class="pulse-ring"></circle>
                        <circle cx="25" cy="25" r="15" class="logo-circle"></circle>
                        <path d="M25 15 L25 35 M15 25 L35 25" class="logo-cross"></path>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>MalariaScope<span class="ai-badge">AI</span></h1>
                    <p>Neural Diagnostic Platform</p>
                </div>
            </div>
            <div class="status-badge">
                <div class="status-dot"></div>
                <span>System Online</span>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h2 class="hero-title">Revolutionary <span class="highlight">AI-Powered</span><br>Malaria Detection</h2>
            <p class="hero-subtitle">Clinical-grade accuracy ‚Ä¢ Real-time analysis ‚Ä¢ Instant results</p>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">üéØ</div>
                    <div class="metric-data">
                        <span class="metric-value">99.2%</span>
                        <span class="metric-label">Accuracy</span>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">‚ö°</div>
                    <div class="metric-data">
                        <span class="metric-value">&lt;3s</span>
                        <span class="metric-label">Analysis Time</span>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üî¨</div>
                    <div class="metric-data">
                        <span class="metric-value" id="scansToday">2,847</span>
                        <span class="metric-label">Scans Today</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Upload Section -->
        <section class="upload-section" id="uploadSection">
            <div class="section-title">
                <h3>Upload Blood Cell Image</h3>
                <p>Drag & drop or click to browse ‚Ä¢ Supports PNG, JPG, JPEG</p>
            </div>

            <div class="upload-wrapper">
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept="image/*" hidden>
                    <div class="upload-illustration">
                        <svg viewBox="0 0 200 200" class="upload-svg">
                            <circle cx="100" cy="100" r="80" class="upload-circle"></circle>
                            <path d="M100 60 L100 140 M70 90 L100 60 L130 90" class="upload-arrow"></path>
                            <rect x="70" y="130" width="60" height="20" rx="5" class="upload-base"></rect>
                        </svg>
                    </div>
                    <h4>Drop your microscopic image here</h4>
                    <p>or click to select from your device</p>
                    <div class="format-badges">
                        <span class="format-badge">PNG</span>
                        <span class="format-badge">JPG</span>
                        <span class="format-badge">JPEG</span>
                    </div>
                </div>

                <!-- Preview -->
                <div class="preview-zone" id="previewZone" style="display: none;">
                    <div class="preview-header">
                        <span class="preview-label">Image Preview</span>
                        <button class="btn-clear" id="btnClear">
                            <svg viewBox="0 0 24 24">
                                <path d="M18 6L6 18M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="preview-container">
                        <img id="previewImage" alt="Preview">
                        <div class="scan-overlay" id="scanOverlay">
                            <div class="scan-beam"></div>
                        </div>
                    </div>
                    <div class="preview-details">
                        <span id="fileName">image.jpg</span>
                        <span id="fileSize">0 KB</span>
                    </div>
                </div>
            </div>

            <button class="btn-analyze" id="btnAnalyze" disabled>
                <span class="btn-content">
                    <svg class="btn-icon" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <span>Analyze Sample</span>
                </span>
                <div class="btn-shimmer"></div>
            </button>
        </section>

        <!-- Loading Screen -->
        <section class="loading-screen" id="loadingScreen" style="display: none;">
            <div class="loading-content">
                <div class="dna-animation">
                    <div class="dna-strand"></div>
                    <div class="dna-strand"></div>
                </div>
                <h3 class="loading-title">Analyzing Blood Sample</h3>
                <p class="loading-subtitle">Deep learning neural network processing...</p>
                
                <div class="progress-stages">
                    <div class="stage" id="stage1">
                        <div class="stage-icon">1</div>
                        <span>Image Processing</span>
                    </div>
                    <div class="stage-connector"></div>
                    <div class="stage" id="stage2">
                        <div class="stage-icon">2</div>
                        <span>CNN Analysis</span>
                    </div>
                    <div class="stage-connector"></div>
                    <div class="stage" id="stage3">
                        <div class="stage-icon">3</div>
                        <span>Result Generation</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h3>Diagnostic Report</h3>
                <span class="report-time" id="reportTime"></span>
            </div>

            <div class="results-layout">
                <!-- Main Result -->
                <div class="result-main">
                    <div class="result-badge" id="resultBadge">
                        <div class="badge-icon" id="badgeIcon">
                            <svg viewBox="0 0 24 24">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        <h4 class="result-title" id="resultTitle">Status</h4>
                        <p class="result-desc" id="resultDesc">Description</p>
                    </div>

                    <!-- Confidence Meter -->
                    <div class="confidence-meter">
                        <div class="meter-header">
                            <span>Confidence Level</span>
                            <span class="confidence-percent" id="confidencePercent">0%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-progress" id="meterProgress"></div>
                            <div class="meter-shine"></div>
                        </div>
                        <div class="meter-scale">
                            <span>Low</span>
                            <span>Medium</span>
                            <span>High</span>
                            <span>Very High</span>
                        </div>
                    </div>

                    <!-- Clinical Note -->
                    <div class="clinical-note" id="clinicalNote">
                        <div class="note-icon">üí°</div>
                        <div class="note-content">
                            <h5>Clinical Recommendation</h5>
                            <p id="noteText">Recommendation will appear here</p>
                        </div>
                    </div>
                </div>

                <!-- Side Panel -->
                <div class="result-sidebar">
                    <div class="info-box">
                        <h5>Analysis Details</h5>
                        <div class="info-row">
                            <span>Model</span>
                            <strong>CustomCNN v2.0</strong>
                        </div>
                        <div class="info-row">
                            <span>Processing Time</span>
                            <strong id="procTime">--</strong>
                        </div>
                        <div class="info-row">
                            <span>Image Quality</span>
                            <strong>Excellent</strong>
                        </div>
                        <div class="info-row">
                            <span>Timestamp</span>
                            <strong id="timestamp">--</strong>
                        </div>
                    </div>

                    <div class="disclaimer-box">
                        <h5>‚öïÔ∏è Medical Disclaimer</h5>
                        <p>This AI system is a screening tool for healthcare professionals. Results must be verified by qualified medical personnel. Not a substitute for professional medical diagnosis.</p>
                    </div>

                    <button class="btn-new-test" id="btnNewTest">
                        <svg viewBox="0 0 24 24">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                        New Analysis
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2024 MalariaScope AI | Powered by Deep Learning & TensorFlow | Saving Lives Through Technology</p>
    </footer>

    <script>
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const previewZone = document.getElementById('previewZone');
        const previewImage = document.getElementById('previewImage');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const btnClear = document.getElementById('btnClear');
        const btnAnalyze = document.getElementById('btnAnalyze');
        const uploadSection = document.getElementById('uploadSection');
        const loadingScreen = document.getElementById('loadingScreen');
        const resultsSection = document.getElementById('resultsSection');
        const btnNewTest = document.getElementById('btnNewTest');
        const scanOverlay = document.getElementById('scanOverlay');
        const scansToday = document.getElementById('scansToday');

        let selectedFile = null;
        let startTime = null;
        let scanCount = 2847;

        // Live counter
        setInterval(() => {
            scanCount += Math.floor(Math.random() * 5);
            scansToday.textContent = scanCount.toLocaleString();
        }, 8000);

        // Upload handlers
        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) handleFile(file);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            selectedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                fileName.textContent = file.name;
                fileSize.textContent = (file.size / 1024).toFixed(2) + ' KB';
                uploadZone.style.display = 'none';
                previewZone.style.display = 'block';
                btnAnalyze.disabled = false;
                resultsSection.style.display = 'none';
                
                setTimeout(() => scanOverlay.classList.add('active'), 100);
                setTimeout(() => scanOverlay.classList.remove('active'), 2500);
            };
            reader.readAsDataURL(file);
        }

        btnClear.addEventListener('click', resetApp);
        btnNewTest.addEventListener('click', resetApp);

        function resetApp() {
            selectedFile = null;
            fileInput.value = '';
            uploadZone.style.display = 'flex';
            previewZone.style.display = 'none';
            btnAnalyze.disabled = true;
            loadingScreen.style.display = 'none';
            resultsSection.style.display = 'none';
        }

        btnAnalyze.addEventListener('click', async () => {
            if (!selectedFile) return;

            startTime = Date.now();
            uploadSection.style.display = 'none';
            loadingScreen.style.display = 'block';

            // Animate stages
            setTimeout(() => document.getElementById('stage1').classList.add('active'), 200);
            setTimeout(() => document.getElementById('stage2').classList.add('active'), 1000);
            setTimeout(() => document.getElementById('stage3').classList.add('active'), 2000);

            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                const response = await fetch('/predict', { method: 'POST', body: formData });
                const data = await response.json();

                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    if (data.error) {
                        alert('Error: ' + data.error);
                        uploadSection.style.display = 'block';
                        return;
                    }
                    displayResults(data);
                }, 3000);
            } catch (error) {
                loadingScreen.style.display = 'none';
                uploadSection.style.display = 'block';
                alert('Analysis failed. Please try again.');
            }
        });

        function displayResults(data) {
            const processingTime = ((Date.now() - startTime) / 1000).toFixed(2);
            const isHealthy = data.prediction === 'Uninfected';

            const resultBadge = document.getElementById('resultBadge');
            const resultTitle = document.getElementById('resultTitle');
            const resultDesc = document.getElementById('resultDesc');
            const badgeIcon = document.getElementById('badgeIcon');

            if (isHealthy) {
                resultBadge.className = 'result-badge healthy';
                resultTitle.textContent = 'UNINFECTED';
                resultDesc.textContent = 'No malaria parasites detected';
                badgeIcon.innerHTML = '<svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            } else {
                resultBadge.className = 'result-badge infected';
                resultTitle.textContent = 'PARASITIZED';
                resultDesc.textContent = 'Malaria parasites detected';
                badgeIcon.innerHTML = '<svg viewBox="0 0 24 24"><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>';
            }

            setTimeout(() => {
                const meterProgress = document.getElementById('meterProgress');
                meterProgress.style.width = data.confidence + '%';
                meterProgress.className = 'meter-progress ' + (isHealthy ? 'healthy' : 'infected');
                animateValue('confidencePercent', 0, data.confidence, 1500);
            }, 300);

            const clinicalNote = document.getElementById('clinicalNote');
            const noteText = document.getElementById('noteText');
            if (isHealthy) {
                clinicalNote.className = 'clinical-note healthy';
                noteText.textContent = 'Blood sample appears normal. Continue routine health monitoring and maintain preventive measures against malaria.';
            } else {
                clinicalNote.className = 'clinical-note infected';
                noteText.textContent = 'Immediate medical consultation required. Seek professional diagnosis and appropriate antimalarial treatment without delay.';
            }

            document.getElementById('procTime').textContent = processingTime + 's';
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
            document.getElementById('reportTime').textContent = 'Generated: ' + new Date().toLocaleString();

            resultsSection.style.display = 'block';
            document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
        }

        function animateValue(id, start, end, duration) {
            const el = document.getElementById(id);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            const timer = setInterval(() => {
                current += increment;
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }
                el.textContent = current.toFixed(2) + '%';
            }, 16);
        }
    </script>
</body>
</html>